<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.userservice.mapper.UsersMapper">

    <insert id="insert" parameterType="usersInsert" useGeneratedKeys="true">
        /** insert  */
        insert into users (
            email, pw, nickname, birth, phone, crt_dt, crt_ip, crt_seq
        ) values (
            #{email}, hash_password_fixed_salt(#{pw}), #{nickname}, #{birth}, #{phone}, CURRENT_TIMESTAMP, #{crtIp}, #{crtSeq}
        )
    </insert>

    <select id="countByEmail" parameterType="string" resultType="int">
        /** countByEmail    */
        select count(1)
        from users
        where email = #{email}
    </select>

    <select id="selectByLogin" resultType="users" >
        /** selectByLogin   */
        select  seq
            ,   email
            ,   nickname
            ,   birth
            ,   phone
            ,   crt_dt
            ,   crt_ip
            ,   crt_seq
            ,   udt_dt
            ,   udt_ip
            ,   udt_seq
        from    users
        where   1=1
        and email   =   #{email}
        and pw   =   hash_password_fixed_salt(#{pw})
    </select>

    <update id="updateProfile" parameterType="users">
        /** updateProfile   */
        update  users
        set file_profile_seq    =   #{fileProfileSeq}
        ,   file_profile_status =   #{fileProfileStatus}
        where   seq =   #{seq}
    </update>


</mapper>


